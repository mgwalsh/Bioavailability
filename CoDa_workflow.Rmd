---
title: CoDA workflows for modeling mineral nutrient compositions of cereal grains
author: M.G. Walsh, R. Rodr√≠guez Iglesias, R. Manners, P.C. Nalivata and M.R. Broadley
date: "Last compiled on `r format(Sys.time(), '%d, %B, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    fig_caption: true
    css: style.css
---

```{r, echo=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

# Introduction

Most empirical models of biogeography, species distributions, photosynthesis, nutrient uptake, yield, trophic dynamics, crop management and/or small area dietary requirements assume no interactions between the essential mineral nutrient elements and typically only describe the associated processes as a function of the potentially most limiting parts (i.e., the [Blackman limitation](https://www.biologydiscussion.com/photosynthesis/blackmans-law-of-limiting-factors-and-his-criticism-photosynthesis/23006)). However, the Blackman limitation does not appear to hold generally. In agricultural systems, the overall (multivariate) mineral nutrient composition is likely to affect both crop yields as well as the overall nutritional quality of plant products that are subsequently consumed by animals, including humans. The objective of this notebook is to provide starter code in [R](https://www.r-project.org/) to explore and report the mineral nutrient compositions of the main cereal grains (maize, pearl-millet, rice and sorghum) that are grown in Malawi ([Gashu et al., 2021](https://doi.org/10.1038/s41586-021-03559-3)). 

*Compositional Data Analysis* (CoDA) refers to the analyses of *compositional data* (CoDa). CoDa are defined as vectors with strictly positive components whose sum is constant (e.g, 1 or 100%). The terms also cover all other *parts* of a whole (so-called *subcompositions*), which carry only relative information ([van den Boogaart and Tolosana-Delgado, 2013](https://link.springer.com/book/10.1007/978-3-642-36809-7)). Because a change in any proportion of a whole changes at least one other proportion, CoDa are interdependent. Arguably, all concentration data should be treated CoDa because as a whole they must sum to their respective per unit totals of all constituent parts e.g., in the case of mg kg^-1^ data, to 10^6^ ppm. CoDa are intrinsically multivariate, and their individual components should probably not be analyzed and interpreted without relating them to one another.

The original approach to CoDA developed by [J. Aitchison (1982)](https://rss.onlinelibrary.wiley.com/doi/10.1111/j.2517-6161.1982.tb01195.x) uses logarithmic ratios (LRs) of the compositional parts as the fundamental starting point for CoDa description and modeling. There is also a CoDa review paper by [M. Greenacre (2021)](https://www.annualreviews.org/doi/pdf/10.1146/annurev-statistics-042720-124436) openly available, which provides excellent guidance, as well as [R scripts](https://github.com/michaelgreenacre/CODAinPractice), about the practical applications and interpretation of CoDa. This notebook is maintained on [Github](https://github.com/mgwalsh/Bioavailability/blob/master/CoDa_workflow.Rmd), and you can fork and alter it from there for your reference and as you see fit.

# General data setup

The data we will be using were generated by the [GeoNutrition project](http://www.geonutrition.com) in Malawi. They consist of 1,808 cereal grain samples that were collected for maize (1,606), millet (31), rice (54), and sorghum (117) in proportion of their national geographical occurrence. The nationally representative cropland sampling frame and the laboratory methods that were used in the data collections are described in [Gashu et al., (2021)](https://doi.org/10.1038/s41586-021-03559-3). 

The data include [ICP-MS](https://en.wikipedia.org/wiki/Inductively_coupled_plasma_mass_spectrometry) concentration measurements of the respective cereal mineral nutrient contents (in ppm), including: Na, Mg, P, S, K, Ca, Cr, Mn, Fe, Co, Cu, Zn, Se, Mo, and I. They also include the georeference of where the samples were collected (lon/lat, EPSG:3857), the dominant cereal crop at that location, and if, or not, fertilizer and/or lime were used in growing the crop. Note that any measurements below their respective detection limits (LOD) have been set to 2/3 of the respective minimum observed values. Other imputation methods are also possible in this context see [Greenacre (2021)](https://www.annualreviews.org/doi/pdf/10.1146/annurev-statistics-042720-124436).

## Data download

To actually run this notebook, you will need to load the packages indicated in the chunk directly below to download and assemble the data. The chunk (not shown but in the markdown document) also generates an overview map of where the samples were collected in Malawi ... you can click and zoom into the individual sampling locations.

```{r, results = 'hide'}
# Package names
packages <- c("osfr", "dplyr", "leaflet", "compositions", "stargazer", "archetypes", "quantreg", "arm")

# Install packages
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Load packages
invisible(lapply(packages, library, character.only = TRUE))

# Create a data folder in your current working directory
dir.create("MW_coda", showWarnings=F)
setwd("./MW_coda")
dir.create("Results")

# Data download from OSF at: https://osf.io/btxyc/
osf_retrieve_file("btxyc") %>% osf_download(conflicts = "overwrite")
codat <- read.table("MW_grain_coda.csv", header=T, sep=",")

# Download figures
osf_retrieve_file("pnw7g") %>% osf_download(conflicts = "overwrite")
```

```{r, echo = FALSE}
# Grain sample locations
w <- leaflet() %>%
  setView(lng = mean(codat$lon), lat = mean(codat$lat), zoom = 7) %>%
  addProviderTiles(providers$OpenStreetMap.Mapnik) %>%
  addCircleMarkers(codat$lon, codat$lat, clusterOptions = markerClusterOptions())
w ## plot widget 
```

## CoDa transforms

This section of the notebook sets up a CoDa data frame that includes 2 amalgamations: mineral **macro-nutrients** (i.e., Na, Mg, P, S, K, and Ca ... in atomic number order), and **micro-nutrients** (i.e., Cr, Mn, Fe, Co, Cu, Zn, Se, Mo, and I). Note that the distinction between *macro* and *micro* here is only intended to reflect the recommended daily dietary values (DDV) that should be consumed by people (with the exception of Co, which should only be consumed as vitamin B12), and not their overall nutritional importance and/or benefits. The compositional macro / micro differences may also prove to be useful for measurement outlier screening, spatial mapping and/or soil property and MIR spectral predictions of nutrient compositions at a later stage. Those subsequent steps will be described in separate notebooks.

This next chunk [closes](https://econ-papers.upf.edu/papers/1554.pdf) the CoDa, and calculates *centered logratios* ([CLR](https://www.rdocumentation.org/packages/compositions/versions/2.0-1/topics/clr)). These can then be analyzed, summarized and interpreted with conventional univariate, multivariate, and data modeling methods ([Greenacre, 2021](https://www.annualreviews.org/doi/pdf/10.1146/annurev-statistics-042720-124436)). Note that you could also use other logratios such as the [ALR](https://www.rdocumentation.org/packages/compositions/versions/2.0-1/topics/alr), or the [ILR](https://www.rdocumentation.org/packages/compositions/versions/2.0-1/topics/ilr) and/or different amalgamations of subcompositions, but we shall leave those possibilities for you to explore. We also write out the resulting data frame to your `./MW_coda/Results` directory should you wish to process it in software other than R.

```{r}
# Calculate the CLRs
varc <- c("Na", "Mg", "P", "S", "K", "Ca", "Cr", "Mn", "Fe", "Co", "Cu", "Zn", "Se", "Mo", "I")
combo <- codat[varc]
combo <- combo / rowSums(combo) ## close the composition
combo <- as.data.frame(clr(combo)) ## centered log ratio (clr) transform

# Define the (macro / micro) amalgamation and add it to the overall nutrient composition
varm <- c("Na", "Mg", "P", "S", "K", "Ca")
macro <- rowSums(combo[varm])
combo <- cbind(combo, macro)

# Attach site data info
locv <- c("CropSampleID", "SoilSampleID", "lat", "lon", "crop", "fert") 
locs <- codat[locv]
site <- cbind(locs, combo)

# Write file
write.csv(site, "./MW_coda/Results/MW_site_coda.csv", row.names = F)
```

You can plot any CLR differences between crop species with something like in this next chunk. There are probably more elegant ways of doing that.

```{r, fig.align = "center", fig.show = 'hold', fig.height = 12, fig.width = 7.2, fig.cap = "Boxplots of nutrient CLR differences between crop species."}

par(mfrow = c(5,3), pty="s", mar=c(2,4,1,1))
boxplot(site$Na ~ site$crop, notch = T, ylab = "Na", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Mg ~ site$crop, notch = T, ylab = "Mg", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$P ~ site$crop, notch = T, ylab = "P", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$S ~ site$crop, notch = T, ylab = "S", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$K ~ site$crop, notch = T, ylab = "K", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Ca ~ site$crop, notch = T, ylab = "Ca", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Cr ~ site$crop, notch = T, ylab = "Cr", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Mn ~ site$crop, notch = T, ylab = "Mn", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Fe ~ site$crop, notch = T, ylab = "Fe", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Co ~ site$crop, notch = T, ylab = "Co", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Cu ~ site$crop, notch = T, ylab = "Cu", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Zn ~ site$crop, notch = T, ylab = "Zn", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Se ~ site$crop, notch = T, ylab = "Se", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$Mo ~ site$crop, notch = T, ylab = "Mo", xlab = "", cex.axis = 1, cex.lab = 1.3)
boxplot(site$I ~ site$crop, notch = T, ylab = "I", xlab = "", cex.axis = 1, cex.lab = 1.3)
```

## Compositional differences between crop species

This section provides initial data model summaries of parts of the CLR transformed data. We focus on the contrast of the macro / micro nutrient subcompositions between crops. This can be readily extended to individual nutrients and/or other compositional amalgamations. This next chunk fits the differences between the macro nutrient CLRs of millet, rice and sorghum as compared to maize. We will be doing this using quantile regression ([`quantreg`](https://cran.r-project.org/web/packages/quantreg/index.html)) to safeguard against any major outliers in the data.

```{r, results = 'asis'}
# Fit nutrients by crop species with quantile regression
m0 <- rq(macro~crop, data = site)
m1 <- rq(Na~crop, data = site)
m2 <- rq(Mg~crop, data = site)
m3 <- rq(P~crop, data = site)
m4 <- rq(S~crop, data = site)
m5 <- rq(K~crop, data = site)
m6 <- rq(Ca~crop, data = site)

# Generate regression summary table
stargazer::stargazer(m0, m1, m2, m3, m4, m5, m6, type = "html", 
                     ci = TRUE, ci.level = 0.95, intercept.bottom = FALSE, digits = 1, 
                     omit.table.layout = "sn", model.numbers = FALSE,
                     column.sep.width = "24pt",
                     covariate.labels = c("Intercept","millet","rice","sorghum"),
                     title = "Macro-nutrient regression summary using maize as the reference crop.")
```
\

Based on this, there appear to be clear differences between the macro compositional parts of the 4 cereal crops. Maize appears to have a significantly higher macro-nutrient proportion than millet, rice or sorghum. Conversely, because of the binary macro / micro contrast that is imposed here, the proportion of total micro-minerals would be expected to be proportionally higher in millet, rice and sorghum as compared to maize. The corresponding micro-nutrient summary is shown in the table below.

```{r, echo = FALSE, results = 'asis'}
# Fit macro-nutrients by crop species and fertilizer use
m7 <- rq(Cr~crop, data = site)
m8 <- rq(Mn~crop, data = site)
m9 <- rq(Fe~crop, data = site)
m10 <- rq(Co~crop, data = site)
m11 <- rq(Cu~crop, data = site)
m12 <- rq(Zn~crop, data = site)
m13 <- rq(Se~crop, data = site)
m14 <- rq(Mo~crop, data = site)
m15 <- rq(I~crop, data = site)

# Generate regression summary table
stargazer::stargazer(m7, m8, m9, m10, m11, m12, m13, m14, m15, type = "html", 
                     ci = TRUE, ci.level = 0.95, intercept.bottom = FALSE, digits = 1, 
                     omit.table.layout = "sn", model.numbers = FALSE,
                     column.sep.width = "24pt",
                     covariate.labels = c("Intercept","millet","rice","sorghum"),
                     title = "Micro-nutrient regression summary using maize as the reference crop.")
```
\

# Compositional archetypes

*Archetypal analysis* ([Cutler and Breiman, 1994](https://www.stat.cmu.edu/technometrics/90-00/vol-36-04/v3604338.pdf)) is an unsupervised learning method similar to e.g., [K-means clustering](https://towardsdatascience.com/k-means-clustering-explained-4528df86a120). It describes each observation in a dataset as a mixture of archetypes. Rather than describing average or typical observations and measurements, archetypal analysis seeks to identify extreme points on the [convex hull](https://en.wikipedia.org/wiki/Convex_hull) of a data matrix, which can provide a simple and quite useful way of clustering and looking at multivariate data ([Eugster and Leisch, 2009](https://cran.r-project.org/web//packages/archetypes/vignettes/archetypes.pdf)). The identified archetypes themselves are mixtures of the individual variables under consideration. Archetypal mixture coefficients and projections are also CoDa, which is why we include them in this notebook. Note that clustering algorithms could also be used in this context ([Greenacre, 2021](https://www.annualreviews.org/doi/pdf/10.1146/annurev-statistics-042720-124436)) .

## Identifying archetypes

This next chunk fits the Malawi CLR data using the [`archetypes`](https://cran.r-project.org/web//packages/archetypes/vignettes/archetypes.pdf) package, which is a robust implementation of Cutler and (1994) algorithm that uses [k-fold cross-validation](https://www.statology.org/k-fold-cross-validation/)

```{r, output = 'hide'}
# Fit nutrient archetypes with 10-fold cross validation
set.seed(85321)
comp.arc <- stepArchetypes(data=site[,7:21], k = 1:10, nrep = 10, verbose = FALSE)
```

```{r, echo = FALSE, fig.align = "center", fig.height = 4, fig.width = 4, fig.cap = "Archetype scree-plot showing the no. of archetypes vs the multivariate residual sums of squares (RSS)."}

par(pty="s", mar=c(4,4,1,1))
screeplot(comp.arc)
```

## Archetypal classification

Similar to other clustering algorithms, we can use the identified archetypes for unsupervised classification and subsequently also for (see e.g., [post-stratification](https://www.sciencedirect.com/topics/mathematics/poststratification)).

```{r}
# Select no. of archetypes, the scree plot above suggests 4-7 ... we use 4 here
comp.arc4 <- bestModel(comp.arc[[4]])

# Classify CLRs by "dominant archetypes" (DA)
darc <- as.data.frame(predict(comp.arc4, site[,7:21]))
darc$DA <- apply(darc, 1, which.max)
colnames(darc) <- c("A1","A2","A3","A4","DA")
site <- cbind(site, darc)

# Overwrite the site file
write.csv(site, "./MW_coda/Results/MW_site_coda.csv", row.names = F)
```

This is an aside, but it gives you an idea of what the "*most*" dominant archetypal sites look like from a [GeoSurvey](https://osf.io/vxc97/) perspective in Malawi. This should remind us of the fact that there are probably quite explicit spatial links to assessing nutrient compositions that could be explored. However, those links are certainly not plainly visible in satellite images, without significant ground data support.

```{r, echo=FALSE, fig.align="center", fig.cap="Dominant archetypal grain nutrient composition sites in Malawi visualized in GeoSurvey.", out.width = '90%'}
knitr::include_graphics("./MW_coda/MW_archetypes.png")
```

We can now also generate a similar plot of the raw nutrient composition data by crop species that were presented above (code not shown, but in the markdown). Rather than focusing on the crop species, the differences in the CLRs are now shown as the differences between the 4 dominant archetypes.

```{r, echo = FALSE, fig.align = "center", fig.show = 'hold', fig.height = 12, fig.width = 7.2, fig.cap = "Boxplots of nutrient CLR differences between dominant archetypes."}

par(mfrow = c(5,3), pty="s", mar=c(2,4,1,1))
boxplot(site$Na ~ site$DA, notch = T, ylab = "Na", xlab = "", cex.lab = 1.3)
boxplot(site$Mg ~ site$DA, notch = T, ylab = "Mg", xlab = "", cex.lab = 1.3)
boxplot(site$P ~ site$DA, notch = T, ylab = "P", xlab = "", cex.lab = 1.3)
boxplot(site$S ~ site$DA, notch = T, ylab = "S", xlab = "", cex.lab = 1.3)
boxplot(site$K ~ site$DA, notch = T, ylab = "K", xlab = "", cex.lab = 1.3)
boxplot(site$Ca ~ site$DA, notch = T, ylab = "Ca", xlab = "", cex.lab = 1.3)
boxplot(site$Cr ~ site$DA, notch = T, ylab = "Cr", xlab = "", cex.lab = 1.3)
boxplot(site$Mn ~ site$DA, notch = T, ylab = "Mn", xlab = "", cex.lab = 1.3)
boxplot(site$Fe ~ site$DA, notch = T, ylab = "Fe", xlab = "", cex.lab = 1.3)
boxplot(site$Co ~ site$DA, notch = T, ylab = "Co", xlab = "", cex.lab = 1.3)
boxplot(site$Cu ~ site$DA, notch = T, ylab = "Cu", xlab = "", cex.lab = 1.3)
boxplot(site$Zn ~ site$DA, notch = T, ylab = "Zn", xlab = "", cex.lab = 1.3)
boxplot(site$Se ~ site$DA, notch = T, ylab = "Se", xlab = "", cex.lab = 1.3)
boxplot(site$Mo ~ site$DA, notch = T, ylab = "Mo", xlab = "", cex.lab = 1.3)
boxplot(site$I ~ site$DA, notch = T, ylab = "I", xlab = "", cex.lab = 1.3)
```

## Post-stratified differences between crop species

The main reason for post-stratification is to improve the precision and accuracy of live survey analyses and also to guide future surveys and/or monitoring activities. There are at least a couple of different ways to handle post-stratification of CoDa (and/or any other data). The first way, which we have already explored partially, would use OLS, GLM and/or quantile regression. The second approach uses mixed-effects ([multilevel](https://en.wikipedia.org/wiki/Multilevel_model)) models and is analogous to [instrumental variable regression](https://www.publichealth.columbia.edu/research/population-health-methods/instrumental-variables) approaches that are commonly used in the analyses of e.g., econometric, epidemiological and environmetric surveys. This initial post-stratification chunk uses [`quantreg`]()

```{r, results = 'asis'}
# Macro-nutrients by DA with quantreg
p1 <- rq(macro~crop + factor(DA), data = site)
p2 <- rq(Na~crop + factor(DA), data = site)
p3 <- rq(Mg~crop + factor(DA), data = site)
p4 <- rq(P~crop + factor(DA), data = site)
p5 <- rq(S~crop + factor(DA), data = site)
p6 <- rq(K~crop + factor(DA), data = site)
p7 <- rq(Ca~crop + factor(DA), data = site)

# Generate regression summary table
stargazer::stargazer(p1, p2, p3, p4, p5, p6, p7, type = "html", 
                     ci = TRUE, ci.level = 0.95, intercept.bottom = FALSE, digits = 1, 
                     omit.table.layout = "sn", model.numbers = FALSE,
                     column.sep.width = "24pt",
                     covariate.labels = c("Intercept","millet","rice","sorghum","DA2","DA3","DA4"),
                     title = "Macro-nutrient quantile regression summary using DA1/maize as the reference.")
```
\

The micro-nutrient CLRs are handled in a similar manner (code not shown, but in the markdown). The table below displays the results.

```{r, echo = FALSE, results = 'asis'}
# Macro-nutrients by DA
p8 <- rq(Cr~crop + factor(DA), data = site)
p9 <- rq(Mn~crop + factor(DA), data = site)
p10 <- rq(Fe~crop + factor(DA), data = site)
p11 <- rq(Co~crop + factor(DA), data = site)
p12 <- rq(Cu~crop + factor(DA), data = site)
p13 <- rq(Zn~crop + factor(DA), data = site)
p14 <- rq(Se~crop + factor(DA), data = site)
p15 <- rq(Mo~crop + factor(DA), data = site)
p16 <- rq(I~crop + factor(DA), data = site)

# Generate regression summary table
stargazer::stargazer(p8, p9, p10, p11, p12, p13, p14, p15, p16, type = "html", 
                     ci = TRUE, ci.level = 0.95, intercept.bottom = FALSE, digits = 1, 
                     omit.table.layout = "sn", model.numbers = FALSE,
                     column.sep.width = "24pt",
                     covariate.labels = c("Intercept","millet","rice","sorghum","DA2","DA3","DA4"),
                     title = "Micro-nutrient quantile regression summary using DA1/maize as the reference.")
```
\

The second approach to post-stratification is to use multilevel models. The next chunk shows how that might be done using the [`lme4` and `arm`](https://cran.r-project.org/web/packages/arm/arm.pdf) packages. Note that dominant archetypes are included as random intercept terms.

```{r, results = 'asis'}
# Macro-nutrients by crop species and DA with lmer
m1 <- lmer(macro~crop + (1|DA), data = site)
m2 <- lmer(Na~crop + (1|DA), data = site)
m3 <- lmer(Mg~crop + (1|DA), data = site)
m4 <- lmer(P~crop + (1|DA), data = site)
m5 <- lmer(S~crop + (1|DA), data = site)
m6 <- lmer(K~crop + (1|DA), data = site)
m7 <- lmer(Ca~crop + (1|DA), data = site)

# Generate regression summary table
stargazer::stargazer(m1, m2, m3, m4, m5, m6, m7, type = "html", 
                     ci = TRUE, ci.level = 0.95, intercept.bottom = FALSE, digits = 1, 
                     omit.table.layout = "sn", model.numbers = FALSE,
                     column.sep.width = "24pt",
                     covariate.labels = c("Intercept","millet","rice","sorghum"),
                     title = "Macro-nutrient multilevel regression summary using maize as the reference.")
```
\

The 9 micro-nutrient CLRs are handled in an identical manner (code not shown, but are included in the markdown). The table below displays the results.

```{r, echo = FALSE, results = 'asis'}
# Micro-nutrients by crop species and DA with lmer
m8 <- lmer(Cr~crop + (1|DA), data = site)
m9 <- lmer(Mn~crop + (1|DA), data = site)
m10 <- lmer(Fe~crop + (1|DA), data = site)
m11 <- lmer(Co~crop + (1|DA), data = site)
m12 <- lmer(Cu~crop + (1|DA), data = site)
m13 <- lmer(Zn~crop + (1|DA), data = site)
m14 <- lmer(Se~crop + (1|DA), data = site)
m15 <- lmer(Mo~crop + (1|DA), data = site)
m16 <- lmer(I~crop + (1|DA), data = site)

# Generate regression summary table
stargazer::stargazer(m8, m9, m10, m11, m12, m13, m14, m15, m16, type = "html", 
                     ci = TRUE, ci.level = 0.95, intercept.bottom = FALSE, digits = 1, 
                     omit.table.layout = "sn", model.numbers = FALSE,
                     column.sep.width = "24pt",
                     covariate.labels = c("Intercept","millet","rice","sorghum"),
                     title = "Micro-nutrient multilevel regression summary using maize as the reference.")
```
\

Based on these initial results, we can't really provide any additional guidance about how to handle post-stratification and/or for the largely analogous small-area estimates ([SAE](https://en.wikipedia.org/wiki/Small_area_estimation)) of the current survey results. Note that one could always use both methods. They are certainly quick to calculate.

# Takeways

The main takeaways from this notebook are the following:

* Converting nutrient concentrations to logratios is a simple step, but unlike other data transformations it conserves the integrity of the relevant compositional parts needed to normalize the data for any subsequent univariate, multivariate and/or inferential analyses and statistics. Also, the CoDa can always be back-transformed into their original units.

* We think that it may be more informative to analyze mineral nutrient concentration data as CoDa. The associated LR conversions (ALR, CLR, ILR) do not make the data any more computationally difficult, but they should improve any subsequendata modeling, geostatistical and/or machine learning based predictions where subcompositional closure principles apply.

* Clustering the CoDa nutrient data in fewer dimensions, e.g., using archetypal analysis, provides a framework and generalization for post-stratifying nutrient survey results that should improve the precision and accuracy the national cereal grain mineral nutrient estimates in Malawi.

* The results from these initial analyses can be applied in subsequent workflows, including generating spectral and spatial predictions for developing enhanced diagnostics for assessing mineral nutrient deficiencies of the commonly grown cereals in Malawi and elsewhere.

Any questions or comments about this notebook are most welcome via [AFSIS](mailto:mgw.africasoils.info).
